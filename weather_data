import os
import shutil
import base64
import shipping_indicators
from IPython.display import HTML, display

# 1. FIND THE CODE
# This locates where the 'shipping_indicators' package was installed by pip
package_path = os.path.dirname(shipping_indicators.__file__)
zip_name = "shipping_code_for_D_drive"
zip_file_path = f"{zip_name}.zip"

# 2. BUNDLE THE CODE
# We create a zip file in your current working directory (/opt/spark/work-dir)
if os.path.exists(zip_file_path):
    os.remove(zip_file_path)

shutil.make_archive(zip_name, 'zip', package_path)

# 3. CREATE THE DOWNLOAD BRIDGE
# We read the file and encode it so it can pass through the browser to your D drive
with open(zip_file_path, "rb") as f:
    bytes_data = f.read()

b64 = base64.b64encode(bytes_data).decode()

# 4. GENERATE THE BUTTON
html_button = f'''
<div style="border: 2px solid #4CAF50; padding: 15px; border-radius: 8px; background-color: #f9f9f9;">
    <p style="margin-top:0; font-family: sans-serif;"><b>Code Package Ready!</b></p>
    <a href="data:application/zip;base64,{b64}" download="{zip_file_path}">
        <button style="padding:12px 24px; background-color:#4CAF50; color:white; 
                       border:none; border-radius:4px; cursor:pointer; font-weight:bold;">
            Click to Download to Windows
        </button>
    </a>
    <p style="font-size: 0.8em; color: #666; margin-bottom:0;">
        After clicking, move the file from <b>Downloads</b> to <b>D:/Shipping_migration/Complete_code</b>
    </p>
</div>
'''

display(HTML(html_button))
