# ==========================================
# CELL 6a: SETUP & DICTIONARY WORD CLOUD
# ==========================================
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
import matplotlib.pyplot as plt
from wordcloud import WordCloud

print("--- Phase 6: Generating Visualizations ---")

if 'oecd_vocabulary' in globals() and oecd_vocabulary is not None:
    vocab_pdf = oecd_vocabulary.toPandas()
    if not vocab_pdf.empty:
        print("\nGenerating Dictionary Word Cloud...")
        
        # THE FIX: Strip out any hidden newline or return characters that crash the image library
        vocab_pdf['noun_chunk'] = vocab_pdf['noun_chunk'].astype(str).str.replace(r'\n|\r', ' ', regex=True)
        
        # Dictionary linking words to their Relative Share importance
        word_freq = dict(zip(vocab_pdf['noun_chunk'], vocab_pdf['relative_share']))
        
        wc = WordCloud(width=1200, height=500, background_color='white', colormap='viridis', max_words=100)
        wc.generate_from_frequencies(word_freq)
        
        plt.figure(figsize=(16, 8))
        plt.imshow(wc, interpolation='bilinear')
        plt.axis('off')
        plt.title("OECD Data Dictionary (Sized by Specificity to Data-Work)", fontsize=22, pad=20)
        plt.tight_layout()
        plt.show()
    else:
        print("Dictionary is empty. Cannot generate Word Cloud.")
